using System;
using System.Drawing;
using System.Windows.Forms;

namespace StudyBuddy
{
    public partial class ApiKeyDialog : Form
    {
        public string ApiKey { get; private set; } = string.Empty;

        public ApiKeyDialog()
        {
            InitializeComponent();
        }

        private void InitializeComponent()
        {
            this.lblTitle = new Label();
            this.lblInstructions = new Label();
            this.txtApiKey = new TextBox();
            this.btnOk = new Button();
            this.btnCancel = new Button();
            this.linkGeminiInfo = new LinkLabel();
            this.SuspendLayout();

            // Form properties
            this.AutoScaleDimensions = new SizeF(8F, 20F);
            this.AutoScaleMode = AutoScaleMode.Font;
            this.ClientSize = new Size(500, 280);
            this.Font = new Font("Segoe UI", 11F, FontStyle.Regular, GraphicsUnit.Point);
            this.FormBorderStyle = FormBorderStyle.FixedDialog;
            this.MaximizeBox = false;
            this.MinimizeBox = false;
            this.Name = "ApiKeyDialog";
            this.StartPosition = FormStartPosition.CenterParent;
            this.Text = "Configure Google Gemini API Key";

            // lblTitle
            this.lblTitle.AutoSize = true;
            this.lblTitle.Font = new Font("Segoe UI", 14F, FontStyle.Bold);
            this.lblTitle.ForeColor = Color.FromArgb(63, 81, 181);
            this.lblTitle.Location = new Point(20, 20);
            this.lblTitle.Name = "lblTitle";
            this.lblTitle.Size = new Size(200, 25);
            this.lblTitle.Text = "Google Gemini API Key";

            // lblInstructions
            this.lblInstructions.Location = new Point(20, 55);
            this.lblInstructions.Name = "lblInstructions";
            this.lblInstructions.Size = new Size(460, 60);
            this.lblInstructions.Text = "To use AI features, you need a Google Gemini API key. You can get one for free from Google AI Studio. The API key will be stored locally and used only for API calls.";

            // linkGeminiInfo
            this.linkGeminiInfo.AutoSize = true;
            this.linkGeminiInfo.Location = new Point(20, 125);
            this.linkGeminiInfo.Name = "linkGeminiInfo";
            this.linkGeminiInfo.Size = new Size(250, 20);
            this.linkGeminiInfo.Text = "Get your free API key at ai.google.dev";
            this.linkGeminiInfo.LinkClicked += (sender, e) =>
            {
                try
                {
                    System.Diagnostics.Process.Start(new System.Diagnostics.ProcessStartInfo
                    {
                        FileName = "https://ai.google.dev/",
                        UseShellExecute = true
                    });
                }
                catch { }
            };

            // txtApiKey
            this.txtApiKey.Location = new Point(20, 155);
            this.txtApiKey.Name = "txtApiKey";
            this.txtApiKey.PlaceholderText = "Enter your Google Gemini API key here...";
            this.txtApiKey.Size = new Size(460, 27);
            this.txtApiKey.UseSystemPasswordChar = true;

            // btnOk
            this.btnOk.BackColor = Color.FromArgb(63, 81, 181);
            this.btnOk.FlatStyle = FlatStyle.Flat;
            this.btnOk.Font = new Font("Segoe UI", 10F, FontStyle.Bold);
            this.btnOk.ForeColor = Color.White;
            this.btnOk.Location = new Point(320, 220);
            this.btnOk.Name = "btnOk";
            this.btnOk.Size = new Size(75, 35);
            this.btnOk.Text = "OK";
            this.btnOk.UseVisualStyleBackColor = false;
            this.btnOk.Click += new EventHandler(this.btnOk_Click);

            // btnCancel
            this.btnCancel.BackColor = Color.Gray;
            this.btnCancel.FlatStyle = FlatStyle.Flat;
            this.btnCancel.Font = new Font("Segoe UI", 10F, FontStyle.Bold);
            this.btnCancel.ForeColor = Color.White;
            this.btnCancel.Location = new Point(405, 220);
            this.btnCancel.Name = "btnCancel";
            this.btnCancel.Size = new Size(75, 35);
            this.btnCancel.Text = "Cancel";
            this.btnCancel.UseVisualStyleBackColor = false;
            this.btnCancel.Click += new EventHandler(this.btnCancel_Click);

            this.Controls.Add(this.lblTitle);
            this.Controls.Add(this.lblInstructions);
            this.Controls.Add(this.linkGeminiInfo);
            this.Controls.Add(this.txtApiKey);
            this.Controls.Add(this.btnOk);
            this.Controls.Add(this.btnCancel);

            this.ResumeLayout(false);
            this.PerformLayout();
        }

        private void btnOk_Click(object sender, EventArgs e)
        {
            if (string.IsNullOrWhiteSpace(txtApiKey.Text))
            {
                MessageBox.Show("Please enter a valid API key.", "Invalid Input", MessageBoxButtons.OK, MessageBoxIcon.Warning);
                return;
            }

            ApiKey = txtApiKey.Text.Trim();
            DialogResult = DialogResult.OK;
            Close();
        }

        private void btnCancel_Click(object sender, EventArgs e)
        {
            DialogResult = DialogResult.Cancel;
            Close();
        }

        private Label lblTitle;
        private Label lblInstructions;
        private TextBox txtApiKey;
        private Button btnOk;
        private Button btnCancel;
        private LinkLabel linkGeminiInfo;
    }
}