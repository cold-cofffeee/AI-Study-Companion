<?xml version="1.0" encoding="UTF-8"?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">
  <!-- 
    Study Buddy Installer Configuration
    WiX Toolset configuration for creating Windows Installer (MSI) package
  -->
  
  <Product Id="*" 
           Name="Study Buddy" 
           Language="1033" 
           Version="1.0.0.0" 
           Manufacturer="Study Buddy Team" 
           UpgradeCode="12345678-1234-1234-1234-123456789012">
    
    <Package InstallerVersion="200" 
             Compressed="yes" 
             InstallScope="perMachine" 
             Description="AI-Powered Study Assistant"
             Comments="Study Buddy helps students learn more effectively with AI-powered tools"
             Manufacturer="Study Buddy Team" />

    <MajorUpgrade DowngradeErrorMessage="A newer version of [ProductName] is already installed." />
    <MediaTemplate EmbedCab="yes" />

    <!-- App Icon -->
    <Icon Id="StudyBuddyIcon.exe" SourceFile="Installer\StudyBuddy\StudyBuddy.exe" />
    <Property Id="ARPPRODUCTICON" Value="StudyBuddyIcon.exe" />
    
    <!-- Add/Remove Programs Properties -->
    <Property Id="ARPHELPLINK" Value="https://github.com/yourusername/studybuddy" />
    <Property Id="ARPURLINFOABOUT" Value="https://github.com/yourusername/studybuddy" />
    <Property Id="ARPNOREPAIR" Value="yes" Secure="yes" />
    
    <!-- Installation Directory -->
    <Directory Id="TARGETDIR" Name="SourceDir">
      <Directory Id="ProgramFilesFolder">
        <Directory Id="INSTALLFOLDER" Name="Study Buddy">
          <!-- Main executable and files will be added here -->
          <Component Id="StudyBuddyExecutable" Guid="*">
            <File Id="StudyBuddyEXE" 
                  Source="Installer\StudyBuddy\StudyBuddy.exe" 
                  KeyPath="yes" 
                  Checksum="yes">
              <!-- Create desktop shortcut -->
              <Shortcut Id="DesktopShortcut"
                        Directory="DesktopFolder"
                        Name="Study Buddy"
                        Description="AI-Powered Study Assistant"
                        WorkingDirectory="INSTALLFOLDER"
                        Icon="StudyBuddyIcon.exe"
                        IconIndex="0"
                        Advertise="yes" />
              <!-- Create Start Menu shortcut -->
              <Shortcut Id="StartMenuShortcut"
                        Directory="ProgramMenuDir"
                        Name="Study Buddy"
                        Description="AI-Powered Study Assistant"
                        WorkingDirectory="INSTALLFOLDER"
                        Icon="StudyBuddyIcon.exe"
                        IconIndex="0"
                        Advertise="yes" />
            </File>
          </Component>
          
          <!-- README and LICENSE -->
          <Component Id="Documentation" Guid="*">
            <File Id="README" Source="Installer\StudyBuddy\README.txt" KeyPath="yes" />
            <File Id="LICENSE" Source="Installer\StudyBuddy\LICENSE.txt" />
          </Component>
          
          <!-- Data Directory -->
          <Directory Id="DataFolder" Name="Data">
            <Component Id="DataFolderComponent" Guid="*">
              <CreateFolder />
            </Component>
          </Directory>
          
          <!-- Logs Directory -->
          <Directory Id="LogsFolder" Name="Logs">
            <Component Id="LogsFolderComponent" Guid="*">
              <CreateFolder />
            </Component>
          </Directory>
        </Directory>
      </Directory>
      
      <!-- Start Menu Folder -->
      <Directory Id="ProgramMenuFolder">
        <Directory Id="ProgramMenuDir" Name="Study Buddy">
          <Component Id="ProgramMenuFolder" Guid="*">
            <RemoveFolder Id="ProgramMenuDir" On="uninstall" />
            <RegistryValue Root="HKCU" 
                          Key="Software\StudyBuddy" 
                          Name="installed" 
                          Type="integer" 
                          Value="1" 
                          KeyPath="yes" />
          </Component>
        </Directory>
      </Directory>
      
      <!-- Desktop Folder -->
      <Directory Id="DesktopFolder" Name="Desktop" />
    </Directory>

    <!-- Features to Install -->
    <Feature Id="ProductFeature" 
             Title="Study Buddy" 
             Level="1"
             Description="Complete Study Buddy application with all features">
      <ComponentRef Id="StudyBuddyExecutable" />
      <ComponentRef Id="Documentation" />
      <ComponentRef Id="DataFolderComponent" />
      <ComponentRef Id="LogsFolderComponent" />
      <ComponentRef Id="ProgramMenuFolder" />
    </Feature>

    <!-- UI Configuration -->
    <UI>
      <UIRef Id="WixUI_InstallDir" />
      <UIRef Id="WixUI_ErrorProgressText" />
      
      <!-- Custom dialog text -->
      <Publish Dialog="ExitDialog"
               Control="Finish"
               Event="DoAction"
               Value="LaunchApplication">WIXUI_EXITDIALOGOPTIONALCHECKBOX = 1 and NOT Installed</Publish>
    </UI>

    <!-- License Agreement -->
    <WixVariable Id="WixUILicenseRtf" Value="License.rtf" />
    
    <!-- Custom action to launch app after installation -->
    <Property Id="WIXUI_EXITDIALOGOPTIONALCHECKBOXTEXT" 
              Value="Launch Study Buddy" />
    <Property Id="WIXUI_EXITDIALOGOPTIONALCHECKBOX" Value="1" />
    
    <Property Id="WixShellExecTarget" Value="[#StudyBuddyEXE]" />
    <CustomAction Id="LaunchApplication"
                  BinaryKey="WixCA"
                  DllEntry="WixShellExec"
                  Impersonate="yes" />

    <!-- Installation Directory UI -->
    <Property Id="WIXUI_INSTALLDIR" Value="INSTALLFOLDER" />
  </Product>
</Wix>
